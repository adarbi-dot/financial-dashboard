<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Clarity - Financial Wellness Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <!-- React + Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap">
  <style>
    body { font-family: 'DM Sans', sans-serif; }
    .gradient-text {
      background: linear-gradient(to right, #38bdf8, #a78bfa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .card-hover { transition: transform .2s ease, box-shadow .2s ease; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0,0,0,.2); }
  </style>
</head>
<body class="bg-slate-950 text-slate-300">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Login Page Component
    function LoginPage({ onLogin }) {
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');

      const handleLogin = async () => {
        try {
          await auth.signInWithEmailAndPassword(email, password);
          onLogin();
        } catch (err) {
          setError(err.message);
        }
      };

      return (
        <div className="flex justify-center items-center h-screen">
          <div className="bg-slate-800 p-10 rounded-xl shadow-xl w-96">
            <h1 className="text-3xl font-bold mb-6 gradient-text text-center">Clarity Login</h1>
            {error && <p className="text-red-500 mb-3">{error}</p>}
            <input
              className="w-full p-3 rounded mb-4 bg-slate-700 placeholder-slate-400 text-white"
              type="email"
              placeholder="Email"
              value={email}
              onChange={e => setEmail(e.target.value)}
            />
            <input
              className="w-full p-3 rounded mb-4 bg-slate-700 placeholder-slate-400 text-white"
              type="password"
              placeholder="Password"
              value={password}
              onChange={e => setPassword(e.target.value)}
            />
            <button
              onClick={handleLogin}
              className="w-full p-3 bg-indigo-500 rounded font-bold hover:bg-indigo-600"
            >
              Login
            </button>
          </div>
        </div>
      );
    }

    // Financial Dashboard Component
    function FinancialDashboard({ onLogout }) {
      const [transactions, setTransactions] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const fetchTransactions = async () => {
          try {
            const snapshot = await db.collection('transactions').orderBy('date', 'desc').get();
            const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setTransactions(data);
            setLoading(false);
          } catch (err) {
            console.error(err);
          }
        };
        fetchTransactions();
      }, []);

      const totalIncome = transactions
        .filter(t => t.type === 'income')
        .reduce((sum, t) => sum + t.amount, 0);

      const totalExpense = transactions
        .filter(t => t.type === 'expense')
        .reduce((sum, t) => sum + t.amount, 0);

      return (
        <div className="p-8 max-w-7xl mx-auto">
          <div className="flex justify-between items-center mb-8">
            <h1 className="text-4xl font-bold gradient-text">Financial Dashboard</h1>
            <button
              onClick={onLogout}
              className="px-4 py-2 bg-red-500 rounded hover:bg-red-600"
            >
              Logout
            </button>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div className="p-6 bg-slate-800 rounded-xl card-hover">
              <h2 className="text-xl font-bold mb-2">Total Income</h2>
              <p className="text-2xl">${totalIncome}</p>
            </div>
            <div className="p-6 bg-slate-800 rounded-xl card-hover">
              <h2 className="text-xl font-bold mb-2">Total Expense</h2>
              <p className="text-2xl">${totalExpense}</p>
            </div>
            <div className="p-6 bg-slate-800 rounded-xl card-hover">
              <h2 className="text-xl font-bold mb-2">Balance</h2>
              <p className="text-2xl">${totalIncome - totalExpense}</p>
            </div>
          </div>
          <div className="overflow-x-auto bg-slate-800 p-4 rounded-xl">
            <table className="min-w-full divide-y divide-slate-700 text-left">
              <thead>
                <tr>
                  <th className="px-6 py-3">Date</th>
                  <th className="px-6 py-3">Description</th>
                  <th className="px-6 py-3">Type</th>
                  <th className="px-6 py-3">Amount</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-slate-700">
                {loading ? (
                  <tr><td colSpan="4" className="text-center py-4">Loading...</td></tr>
                ) : transactions.length === 0 ? (
                  <tr><td colSpan="4" className="text-center py-4">No transactions found.</td></tr>
                ) : transactions.map(t => (
                  <tr key={t.id}>
                    <td className="px-6 py-3">{new Date(t.date.seconds * 1000).toLocaleDateString()}</td>
                    <td className="px-6 py-3">{t.description}</td>
                    <td className="px-6 py-3">{t.type}</td>
                    <td className="px-6 py-3">${t.amount}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    // Main App Component
    function App() {
      const [user, setUser] = useState(null);

      useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged(u => setUser(u));
        return () => unsubscribe();
      }, []);

      const handleLogout = () => {
        auth.signOut();
      };

      if (!user) return <LoginPage onLogin={() => {}} />;
      return <FinancialDashboard onLogout={handleLogout} />;
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>

  <!-- Cloudflare iframe script added -->
  <script>
    (function(){
      function c(){
        var b=a.contentDocument||a.contentWindow.document;
        if(b){
          var d=b.createElement('script');
          d.innerHTML="window.__CF$cv$params={r:'97dd3fafd2df3415',t:'MTc1NzY1NzUwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
          b.getElementsByTagName('head')[0].appendChild(d)
        }
      }
      if(document.body){
        var a=document.createElement('iframe');
        a.height=1;a.width=1;a.style.position='absolute';
        a.style.top=0;a.style.left=0;a.style.border='none';
        a.style.visibility='hidden';
        document.body.appendChild(a);
        if('loading'!==document.readyState) c();
        else if(window.addEventListener) document.addEventListener('DOMContentLoaded', c);
        else {
          var e=document.onreadystatechange||function(){};
          document.onreadystatechange=function(b){
            e(b);
            'loading'!==document.readyState&&(document.onreadystatechange=e,c())
          }
        }
      }
    })();
  </script>
</body>
</html>
