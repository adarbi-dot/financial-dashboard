<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity - Financial Wellness Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- React and Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap">
    <style>
        body {
            font-family: 'DM Sans', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(to right, #38bdf8, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .card-hover {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }
        .progress-bar {
            background: linear-gradient(90deg, #38bdf8, #a78bfa);
        }
        .section-content {
            display: none;
        }
        .section-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Helper Functions and Data ---
        const exchangeRates = { 'USD': 1, 'AED': 3.67, 'EUR': 1.08, 'GBP': 1.25 };
        const categories = {
            'Personal Expense': ['Groceries', 'Rent', 'Utilities', 'Entertainment', 'Transportation', 'Subscriptions', 'Other Personal'],
            'Business Expense': ['Software', 'Freelance Tools', 'Co-working Space', 'Marketing', 'Education', 'Other Business'],
            'Income': ['Client Work', 'Bonus', 'Tips', 'Salary', 'Other Income']
        };
        const currencies = [ { code: 'USD', symbol: '$' }, { code: 'AED', symbol: 'د.إ' }, { code: 'EUR', symbol: '€' }, { code: 'GBP', symbol: '£' } ];
        const getSymbol = (code) => currencies.find(c => c.code === code)?.symbol || '';
        const formatDate = (dateString) => new Date(dateString).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

        // --- Login Page Component ---
        const LoginPage = ({ auth, setError, setMessage }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');

            const handleAuthAction = async (e) => {
                e.preventDefault();
                setError('');
                try {
                    if (isLogin) {
                        await firebase.auth().signInWithEmailAndPassword(email, password);
                    } else {
                        await firebase.auth().createUserWithEmailAndPassword(email, password);
                    }
                } catch (error) {
                    setError(error.message);
                }
            };

            return (
                <div className="flex items-center justify-center min-h-screen bg-slate-950">
                    <div className="w-full max-w-md p-8 space-y-6 bg-slate-900 rounded-2xl shadow-2xl">
                        <div className="text-center">
                            <h1 className="text-4xl font-extrabold gradient-text">Clarity</h1>
                            <p className="text-slate-400 mt-2">{isLogin ? 'Welcome back, log in to continue' : 'Create an account to get started'}</p>
                        </div>
                        <form onSubmit={handleAuthAction} className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium mb-1 text-slate-400">Email Address</label>
                                <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} required className="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 focus:ring-2 focus:ring-blue-500 text-white" placeholder="you@example.com" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-1 text-slate-400">Password</label>
                                <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} required className="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 focus:ring-2 focus:ring-blue-500 text-white" placeholder="••••••••" />
                            </div>
                            <button type="submit" className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">{isLogin ? 'Login' : 'Sign Up'}</button>
                        </form>
                        <p className="text-center text-sm text-slate-400">{isLogin ? "Don't have an account? " : "Already have an account? "}<button onClick={() => { setIsLogin(!isLogin); setError(''); }} className="font-medium text-blue-400 hover:underline">{isLogin ? 'Sign Up' : 'Login'}</button></p>
                    </div>
                </div>
            );
        };

        // --- Main Application Component ---
        const FinancialDashboard = ({ user, db, auth }) => {
            const [transactions, setTransactions] = useState([]);
            const [baseCurrency, setBaseCurrency] = useState(localStorage.getItem('userBaseCurrency') || 'USD');
            const [activeSection, setActiveSection] = useState('dashboard');
            
            useEffect(() => {
                if (!db || !user) return;
                const transactionsRef = firebase.firestore().collection(`users/${user.uid}/transactions`);
                const unsubscribe = transactionsRef.onSnapshot((snapshot) => {
                    const fetched = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    fetched.sort((a, b) => new Date(b.date) - new Date(a.date));
                    setTransactions(fetched);
                });
                return () => unsubscribe();
            }, [db, user]);

            const totals = useMemo(() => {
                let totalIncome = 0;
                let totalExpense = 0;
                transactions.forEach(t => {
                    const rate = exchangeRates[t.currency] || 1;
                    const baseRate = exchangeRates[baseCurrency] || 1;
                    const convertedAmount = t.amount * (rate / baseRate);
                    if (t.type === 'Income') totalIncome += convertedAmount;
                    else totalExpense += convertedAmount;
                });
                return {
                    income: totalIncome.toFixed(2),
                    expense: totalExpense.toFixed(2),
                    net: (totalIncome - totalExpense).toFixed(2)
                };
            }, [transactions, baseCurrency]);

            const recentTransactions = transactions.slice(0, 5);
            const userName = user.email.split('@')[0];
            const currencySymbol = getSymbol(baseCurrency);

            const categoryBreakdown = useMemo(() => {
                const breakdown = {};
                transactions.forEach(t => {
                    if (t.type !== 'Income') {
                        const rate = exchangeRates[t.currency] || 1;
                        const baseRate = exchangeRates[baseCurrency] || 1;
                        const convertedAmount = t.amount * (rate / baseRate);
                        breakdown[t.subcategory] = (breakdown[t.subcategory] || 0) + convertedAmount;
                    }
                });
                return Object.entries(breakdown)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);
            }, [transactions, baseCurrency]);

            const handleSignOut = async () => {
                try {
                    await firebase.auth().signOut();
                } catch (error) {
                    console.error('Error signing out:', error);
                }
            };

            const showSection = (sectionId) => {
                setActiveSection(sectionId);
            };

            return (
                <div>
                    {/* Navigation */}
                    <nav className="bg-slate-900/50 backdrop-blur-sm border-b border-slate-800 sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center h-16">
                                <div className="flex items-center">
                                    <div className="text-2xl font-bold gradient-text">Clarity</div>
                                </div>
                                <div className="hidden md:block">
                                    <div className="ml-10 flex items-baseline space-x-4">
                                        <button onClick={() => showSection('dashboard')} className={`px-3 py-2 rounded-md text-sm font-medium ${activeSection === 'dashboard' ? 'text-blue-400' : 'text-slate-300 hover:text-white'}`}>Dashboard</button>
                                        <button onClick={() => showSection('transactions')} className={`px-3 py-2 rounded-md text-sm font-medium ${activeSection === 'transactions' ? 'text-blue-400' : 'text-slate-300 hover:text-white'}`}>Transactions</button>
                                        <button onClick={() => showSection('goals')} className={`px-3 py-2 rounded-md text-sm font-medium ${activeSection === 'goals' ? 'text-blue-400' : 'text-slate-300 hover:text-white'}`}>Goals</button>
                                        <button onClick={() => showSection('insights')} className={`px-3 py-2 rounded-md text-sm font-medium ${activeSection === 'insights' ? 'text-blue-400' : 'text-slate-300 hover:text-white'}`}>Insights</button>
                                    </div>
                                </div>
                                <div className="flex items-center space-x-4">
                                    <button onClick={handleSignOut} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                        Sign Out
                                    </button>
                                    <div className="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full"></div>
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content Container */}
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        
                        {/* Dashboard Section */}
                        {activeSection === 'dashboard' && (
                            <div>
                                {/* Welcome Section */}
                                <div className="mb-8">
                                    <h1 className="text-3xl font-bold text-white mb-2">Welcome back, {userName}! 👋</h1>
                                    <p className="text-slate-400">Here's your financial overview for this month</p>
                                </div>

                                {/* Stats Cards */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                    <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6 card-hover">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-400 text-sm font-medium">Net Balance</p>
                                                <p className="text-2xl font-bold text-white">{currencySymbol}{totals.net}</p>
                                                <p className={`text-sm mt-1 ${parseFloat(totals.net) >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                    {parseFloat(totals.net) >= 0 ? 'Positive' : 'Negative'} balance
                                                </p>
                                            </div>
                                            <div className="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                                                <svg className="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6 card-hover">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-400 text-sm font-medium">Total Expenses</p>
                                                <p className="text-2xl font-bold text-white">{currencySymbol}{totals.expense}</p>
                                                <p className="text-red-400 text-sm mt-1">{transactions.filter(t => t.type !== 'Income').length} transactions</p>
                                            </div>
                                            <div className="w-12 h-12 bg-red-500/20 rounded-lg flex items-center justify-center">
                                                <svg className="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6 card-hover">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-400 text-sm font-medium">Total Income</p>
                                                <p className="text-2xl font-bold text-white">{currencySymbol}{totals.income}</p>
                                                <p className="text-green-400 text-sm mt-1">{transactions.filter(t => t.type === 'Income').length} transactions</p>
                                            </div>
                                            <div className="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                                <svg className="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6 card-hover">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-400 text-sm font-medium">Total Transactions</p>
                                                <p className="text-2xl font-bold text-white">{transactions.length}</p>
                                                <p className="text-purple-400 text-sm mt-1">All time</p>
                                            </div>
                                            <div className="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                                <svg className="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Charts Section */}
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                                    {/* Spending Chart */}
                                    <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6">
                                        <h3 className="text-xl font-semibold text-white mb-4">Recent Activity</h3>
                                        <div className="h-48 flex items-center justify-center">
                                            <div className="text-center">
                                                <div className="text-4xl mb-4">📊</div>
                                                <p className="text-slate-400">Visual charts coming soon!</p>
                                                <p className="text-sm text-slate-500 mt-2">Your data is being tracked</p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Category Breakdown */}
                                    <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6">
                                        <h3 className="text-xl font-semibold text-white mb-4">Top Spending Categories</h3>
                                        <div className="space-y-3">
                                            {categoryBreakdown.length > 0 ? categoryBreakdown.map(([category, amount], index) => (
                                                <div key={category} className="flex items-center justify-between">
                                                    <div className="flex items-center space-x-3">
                                                        <div className={`w-3 h-3 rounded-full ${
                                                            index === 0 ? 'bg-blue-400' :
                                                            index === 1 ? 'bg-purple-400' :
                                                            index === 2 ? 'bg-pink-400' :
                                                            index === 3 ? 'bg-green-400' : 'bg-yellow-400'
                                                        }`}></div>
                                                        <span className="text-sm text-slate-300">{category}</span>
                                                    </div>
                                                    <span className="text-sm text-white">{currencySymbol}{amount.toFixed(2)}</span>
                                                </div>
                                            )) : (
                                                <div className="text-center py-8">
                                                    <p className="text-slate-400">No expense data yet</p>
                                                    <p className="text-sm text-slate-500 mt-1">Start adding transactions to see breakdown</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* Recent Transactions */}
                                <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6">
                                    <div className="flex justify-between items-center mb-6">
                                        <h3 className="text-xl font-semibold text-white">Recent Transactions</h3>
                                        <button onClick={() => showSection('transactions')} className="text-blue-400 hover:text-blue-300 text-sm font-medium">View All</button>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        {recentTransactions.length > 0 ? recentTransactions.map((transaction) => (
                                            <div key={transaction.id} className="flex items-center justify-between py-3 border-b border-slate-800">
                                                <div className="flex items-center space-x-3">
                                                    <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${
                                                        transaction.type === 'Income' ? 'bg-green-500/20' : 'bg-red-500/20'
                                                    }`}>
                                                        <span className={`text-sm ${
                                                            transaction.type === 'Income' ? 'text-green-400' : 'text-red-400'
                                                        }`}>
                                                            {transaction.type === 'Income' ? '💰' : 
                                                             transaction.subcategory === 'Groceries' ? '🛒' :
                                                             transaction.subcategory === 'Transportation' ? '🚗' :
                                                             transaction.subcategory === 'Entertainment' ? '🎬' :
                                                             transaction.subcategory === 'Utilities' ? '⚡' : '💳'}
                                                        </span>
                                                    </div>
                                                    <div>
                                                        <p className="font-medium text-white">{transaction.description || transaction.subcategory}</p>
                                                        <p className="text-sm text-slate-400">{formatDate(transaction.date)}</p>
                                                    </div>
                                                </div>
                                                <span className={`font-medium ${
                                                    transaction.type === 'Income' ? 'text-green-400' : 'text-red-400'
                                                }`}>
                                                    {transaction.type === 'Income' ? '+' : '-'}{getSymbol(transaction.currency)}{transaction.amount}
                                                </span>
                                            </div>
                                        )) : (
                                            <div className="text-center py-8">
                                                <div className="text-4xl mb-4">📝</div>
                                                <p className="text-slate-400">No transactions yet</p>
                                                <p className="text-sm text-slate-500 mt-1">Your transactions will appear here</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Transactions Section */}
                        {activeSection === 'transactions' && (
                            <div>
                                <div className="mb-8">
                                    <h1 className="text-3xl font-bold text-white mb-2">All Transactions</h1>
                                    <p className="text-slate-400">View and manage all your financial transactions</p>
                                </div>

                                <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6">
                                    <div className="flex justify-between items-center mb-6">
                                        <h3 className="text-xl font-semibold text-white">Transaction History ({transactions.length})</h3>
                                        <div className="flex space-x-2">
                                            <button className="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">Filter</button>
                                            <button className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">Export</button>
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        {transactions.length > 0 ? transactions.map((transaction) => (
                                            <div key={transaction.id} className="flex items-center justify-between py-4 border-b border-slate-800">
                                                <div className="flex items-center space-x-4">
                                                    <div className={`w-12 h-12 rounded-lg flex items-center justify-center ${
                                                        transaction.type === 'Income' ? 'bg-green-500/20' : 'bg-red-500/20'
                                                    }`}>
                                                        <span className={`${
                                                            transaction.type === 'Income' ? 'text-green-400' : 'text-red-400'
                                                        }`}>
                                                            {transaction.type === 'Income' ? '💰' : 
                                                             transaction.subcategory === 'Groceries' ? '🛒' :
                                                             transaction.subcategory === 'Transportation' ? '🚗' :
                                                             transaction.subcategory === 'Entertainment' ? '🎬' :
                                                             transaction.subcategory === 'Utilities' ? '⚡' : '💳'}
                                                        </span>
                                                    </div>
                                                    <div>
                                                        <p className="font-medium text-white">{transaction.description || transaction.subcategory}</p>
                                                        <p className="text-sm text-slate-400">{transaction.subcategory} • {formatDate(transaction.date)}</p>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <span className={`font-medium text-lg ${
                                                        transaction.type === 'Income' ? 'text-green-400' : 'text-red-400'
                                                    }`}>
                                                        {transaction.type === 'Income' ? '+' : '-'}{getSymbol(transaction.currency)}{transaction.amount}
                                                    </span>
                                                    <p className="text-xs text-slate-400">{transaction.currency}</p>
                                                </div>
                                            </div>
                                        )) : (
                                            <div className="text-center py-12">
                                                <div className="text-6xl mb-4">📝</div>
                                                <p className="text-xl text-slate-400 mb-2">No transactions yet</p>
                                                <p className="text-slate-500">Start tracking your finances by adding your first transaction</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Goals Section */}
                        {activeSection === 'goals' && (
                            <div>
                                <div className="mb-8">
                                    <h1 className="text-3xl font-bold text-white mb-2">Financial Goals</h1>
                                    <p className="text-slate-400">Track and manage your savings goals</p>
                                </div>

                                <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6 mb-8">
                                    <div className="flex justify-between items-center mb-6">
                                        <h3 className="text-xl font-semibold text-white">Goal Planning</h3>
                                        <button className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                            Add New Goal
                                        </button>
                                    </div>
                                    
                                    <div className="text-center py-12">
                                        <div className="text-6xl mb-4">🎯</div>
                                        <p className="text-xl text-slate-400 mb-2">Goals feature coming soon!</p>
                                        <p className="text-slate-500">Set and track your financial goals with smart recommendations</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Insights Section */}
                        {activeSection === 'insights' && (
                            <div>
                                <div className="mb-8">
                                    <h1 className="text-3xl font-bold text-white mb-2">Financial Insights</h1>
                                    <p className="text-slate-400">AI-powered insights to improve your financial health</p>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                                    <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6">
                                        <h3 className="text-xl font-semibold text-white mb-4">💡 Smart Recommendations</h3>
                                        <div className="space-y-4">
                                            {parseFloat(totals.net) > 0 ? (
                                                <div className="bg-green-500/10 border border-green-500/20 rounded-lg p-4">
                                                    <h4 className="font-medium text-green-400 mb-2">Great Financial Health!</h4>
                                                    <p className="text-sm text-slate-300">You have a positive balance of {currencySymbol}{totals.net}. Consider setting up savings goals.</p>
                                                </div>
                                            ) : (
                                                <div className="bg-red-500/10 border border-red-500/20 rounded-lg p-4">
                                                    <h4 className="font-medium text-red-400 mb-2">Review Your Spending</h4>
                                                    <p className="text-sm text-slate-300">Your expenses exceed income by {currencySymbol}{Math.abs(parseFloat(totals.net))}. Consider budgeting.</p>
                                                </div>
                                            )}
                                            
                                            {transactions.length > 0 && (
                                                <div className="bg-blue-500/10 border border-blue-500/20 rounded-lg p-4">
                                                    <h4 className="font-medium text-blue-400 mb-2">Track Your Progress</h4>
                                                    <p className="text-sm text-slate-300">You have {transactions.length} transactions recorded. Keep tracking for better insights!</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6">
                                        <h3 className="text-xl font-semibold text-white mb-4">📊 Your Statistics</h3>
                                        <div className="space-y-4">
                                            <div className="flex justify-between items-center">
                                                <span className="text-slate-300">Total Income</span>
                                                <span className="text-white font-medium">{currencySymbol}{totals.income}</span>
                                            </div>
                                            <div className="flex justify-between items-center">
                                                <span className="text-slate-300">Total Expenses</span>
                                                <span className="text-white font-medium">{currencySymbol}{totals.expense}</span>
                                            </div>
                                            <div className="flex justify-between items-center">
                                                <span className="text-slate-300">Net Balance</span>
                                                <span className={`font-medium ${parseFloat(totals.net) >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                    {currencySymbol}{totals.net}
                                                </span>
                                            </div>
                                            <div className="flex justify-between items-center">
                                                <span className="text-slate-300">Base Currency</span>
                                                <span className="text-white font-medium">{baseCurrency}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- App Gatekeeper ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [auth, setAuth] = useState(null);
            const [db, setDb] = useState(null);
            const [isInitializing, setIsInitializing] = useState(true);
            const [error, setError] = useState('');

            useEffect(() => {
                const firebaseConfig = {
                    apiKey: "AIzaSyCEwNa6knQpuCV_eLgKLr7m-88ufWP8484",
                    authDomain: "financial-wellness-dashboard.firebaseapp.com",
                    projectId: "financial-wellness-dashboard",
                    storageBucket: "financial-wellness-dashboard.appspot.com",
                    messagingSenderId: "599378817258",
                    appId: "1:599378817258:web:95841307d6960986f36793"
                };

                try {
                    firebase.initializeApp(firebaseConfig);
                    const authInstance = firebase.auth();
                    const dbInstance = firebase.firestore();
                    setAuth(authInstance);
                    setDb(dbInstance);
                    
                    const unsubscribe = authInstance.onAuthStateChanged((currentUser) => {
                        setUser(currentUser);
                        setIsInitializing(false);
                    });
                    return () => unsubscribe();
                } catch (error) {
                    console.error("Error initializing Firebase:", error);
                    setError("Failed to initialize app");
                    setIsInitializing(false);
                }
            }, []);

            if (isInitializing) {
                return (
                    <div className="flex items-center justify-center min-h-screen bg-slate-950">
                        <div className="text-center">
                            <div className="text-4xl font-bold gradient-text mb-4">Clarity</div>
                            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"></div>
                            <p className="text-slate-400 mt-4">Loading your dashboard...</p>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="flex items-center justify-center min-h-screen bg-slate-950">
                        <div className="text-center">
                            <div className="text-red-400 text-xl mb-4">⚠️ Error</div>
                            <p className="text-slate-400">{error}</p>
                        </div>
                    </div>
                );
            }

            return user ? <FinancialDashboard user={user} db={db} auth={auth} /> : <LoginPage auth={auth} setError={setError} />;
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97d08570b42fc71e',t:'MTc1NzUyNDA0Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
