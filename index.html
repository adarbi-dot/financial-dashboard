<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-white font-sans p-6">

    <div id="dashboard" class="max-w-7xl mx-auto">

        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">Financial Insights</h1>
            <p class="text-slate-400">AI-powered insights to improve your financial health</p>
        </div>

        <!-- Main Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">

            <!-- Smart Recommendations Column -->
            <div class="lg:col-span-2 bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-white">ðŸ’¡ Smart Recommendations</h3>
                    <button id="generateBtn" class="px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-blue-600 hover:bg-blue-700 text-white flex items-center space-x-2">
                        <span>Generate New Insights</span>
                    </button>
                </div>
                <div id="insightsContainer" class="space-y-4 text-slate-400 text-center py-8">
                    Click "Generate New Insights" to get personalized recommendations from the AI based on your latest transactions.
                </div>
            </div>

            <!-- Spending Patterns Column -->
            <div class="lg:col-span-1 bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-xl p-6">
                <h3 class="text-xl font-semibold text-white mb-4">ðŸ“Š Spending Patterns</h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-300">Highest spending day</span>
                        <span class="text-white font-medium">Friday</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-slate-300">Most frequent category</span>
                        <span class="text-white font-medium">Food & Dining</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-slate-300">Average transaction</span>
                        <span class="text-white font-medium">$47.32</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-slate-300">Monthly trend</span>
                        <span class="text-red-400 font-medium">+8.2% â†—</span>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Sample financial data
        const totals = { income: 5000, expense: 3200, net: 1800 };
        const transactions = [
            { date: "2025-09-01", category: "Food & Dining", amount: 45.2 },
            { date: "2025-09-02", category: "Transport", amount: 12.5 },
            { date: "2025-09-03", category: "Shopping", amount: 78.1 },
            { date: "2025-09-04", category: "Entertainment", amount: 35.0 },
            { date: "2025-09-05", category: "Food & Dining", amount: 56.0 }
        ];
        const baseCurrency = "USD";

        const insightsContainer = document.getElementById("insightsContainer");
        const generateBtn = document.getElementById("generateBtn");

        generateBtn.addEventListener("click", handleGenerateInsights);

        async function handleGenerateInsights() {
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>Generating...';
            insightsContainer.innerHTML = "";

            try {
                const apiKey = "AIzaSyCEwNa6knQpuCV_eLgKLr7m-88ufWP8484"; // Replace with your own key if needed
                const prompt = `
                    You are an expert financial analyst named Clarity. Your job is to analyze the user's financial data and provide three brief, actionable recommendations.

                    **RULES:**
                    1. Analyze the provided financial data summary.
                    2. Generate exactly three recommendations.
                    3. For each recommendation, provide a "title", a "recommendation" text, and a "type" ('positive', 'negative', or 'neutral').
                    4. Your entire response MUST be ONLY a valid JSON array of three objects.

                    **USER'S FINANCIAL DATA:**
                    ---
                    Total Income: ${totals.income} ${baseCurrency}
                    Total Expenses: ${totals.expense} ${baseCurrency}
                    Net Flow: ${totals.net} ${baseCurrency}
                    Transaction Count: ${transactions.length}
                    Recent Transactions (JSON): ${JSON.stringify(transactions.slice(0, 15))}
                    ---
                `;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) throw new Error("The AI analysis service is currently unavailable.");

                const result = await response.json();
                const rawJsonText = result.candidates[0].content.parts[0].text;
                const match = rawJsonText.match(/\[.*\]/s);
                if (!match) throw new Error("The AI returned an invalid format for the insights.");

                const parsedInsights = JSON.parse(match[0]);

                // Render insights
                parsedInsights.forEach(insight => {
                    const colorMap = {
                        positive: "green",
                        negative: "red",
                        neutral: "blue"
                    };
                    const container = document.createElement("div");
                    container.className = `border rounded-lg p-4 bg-${colorMap[insight.type]}-500/10 border-${colorMap[insight.type]}-500/20`;
                    container.innerHTML = `
                        <h4 class="font-medium mb-2 text-${colorMap[insight.type]}-400">${insight.title}</h4>
                        <p class="text-sm text-slate-300">${insight.recommendation}</p>
                    `;
                    insightsContainer.appendChild(container);
                });

            } catch (error) {
                insightsContainer.innerHTML = `
                    <div class="border rounded-lg p-4 bg-red-500/10 border-red-500/20">
                        <h4 class="font-medium mb-2 text-red-400">Error Generating Insights</h4>
                        <p class="text-sm text-slate-300">Sorry, I encountered an error: ${error.message}. Please try again.</p>
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<span>Generate New Insights</span>';
            }
        }
    </script>

</body>
</html>
